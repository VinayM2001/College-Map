<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no" />
<title>Interactive 3D Map – Mobile Optimized</title>

<!-- model-viewer -->
<script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.4.0/model-viewer.min.js"></script>

<style>
/* --- Base Styling --- */
html,body{
  margin:0;padding:0;
  height:100%;
  width:100%;
  overflow:hidden;
  background:linear-gradient(180deg,#06131f,#0e2030);
  color:#f3f8ff;
  font-family:Inter,system-ui,Arial,sans-serif;
}

/* --- Model Viewer Container --- */
.viewer-wrap{
  position:relative;
  width:100%;
  height:100vh;
  overflow:hidden;
  display:flex;
  align-items:center;
  justify-content:center;
}

/* --- Model Viewer --- */
model-viewer{
  width:100%;
  height:100%;
  background:linear-gradient(180deg,#d7d2cc 0%,#eef3f9 100%);
  --poster-color: transparent;
  --progress-bar-color: #009dff;
  --progress-bar-height: 3px;
  border:none;
  touch-action: pan-y;
  outline:none;
}

/* --- Overlay UI --- */
.ui-panel{
  position:absolute;
  top:1rem;
  left:50%;
  transform:translateX(-50%);
  display:flex;
  flex-wrap:wrap;
  gap:0.5rem;
  justify-content:center;
  z-index:10;
}

/* Buttons */
button{
  background:rgba(79, 77, 77, 0.171);
  border:1px solid rgba(255, 255, 255, 0.521);
  color:#ffffff;
  border-radius:10px;
  padding:0.6rem 1rem;
  font-size:0.9rem;
  font-weight:600;
  backdrop-filter: blur(6px);
  cursor:pointer;
  transition: all 0.25s ease;
}
button.active{
  background:linear-gradient(90deg,#009dff,#66d1ff);
  color:#130d00;
  border:1px solid transparent;
}

/* Floors */
.floors{
  display:flex;
  gap:0.4rem;
}

/* Bottom Controls */
.controls-bottom{
  position:absolute;
  bottom:1rem;
  left:50%;
  transform:translateX(-50%);
  display:flex;
  gap:0.8rem;
  flex-wrap:wrap;
  justify-content:center;
  z-index:10;
}

/* Slider (phi control) */
#tilt-slider{
  position:absolute;
  bottom: 5rem;
  left:50%;
  transform:translateX(-50%);
  rotate: 90deg;
  width:90%;
  z-index:10;
  display:none;
}
#tilt-slider input{
  width:100%;
  appearance:none;
  height:6px;
  background:rgb(255, 255, 255);
  border-radius:5px;
  outline:none;
}
#tilt-slider input::-webkit-slider-thumb{
  appearance:none;
  width:20px;height:20px;
  border-radius:50%;
  background:linear-gradient(90deg,#009dff,#66d1ff);
  border:2px solid white;
}

/* Hotspots */
.hotspot{
  background:none;
  border:none;
  cursor:pointer;
  position:relative;
}
.hotspot img{
  width:48px;height:48px;
  border-radius:50%;
  border:2px solid #fff;
  box-shadow:0 4px 12px rgba(0,0,0,0.4);
}
.hotspot .label{
  position:absolute;
  bottom:-1.6rem;
  left:50%;
  transform:translateX(-50%);
  background:rgba(0,0,0,0.7);
  color:#fff;
  font-size:0.75rem;
  padding:0.2rem 0.5rem;
  border-radius:6px;
  white-space:nowrap;
  display:none;
}
.hotspot:hover .label{display:block;}

/* Legend */
.legend{
  position:absolute;
  right:1rem;
  bottom:4rem;
  background:rgba(255,255,255,0.1);
  border-radius:10px;
  padding:0.6rem 0.8rem;
  font-size:0.8rem;
  color:#d1d9e8;
  backdrop-filter:blur(6px);
  border:1px solid rgba(55, 55, 55, 0.1);
}

/* Responsive Scaling */
@media (min-width:600px){
  button{font-size:1rem;padding:0.7rem 1.1rem;}
  .hotspot img{width:56px;height:56px;}
  .legend{font-size:0.9rem;}
}
</style>
</head>

<body>
  <div class="viewer-wrap">

    <model-viewer
      id="viewer"
      src="G_floor_Final.glb"
      alt="Campus Map"
      camera-controls
      shadow-intensity="1"
      exposure="1.15"
      environment-image="neutral"
      tone-mapping="aces"
      shadow-softness="0.9"
      touch-action="pan-y">

      <!-- Realistic lighting -->
      <directional-light slot="hotspot-light" intensity="2" color="#fff" data-position="5 8 5"></directional-light>
      <hemisphere-light slot="hotspot-light" intensity="1" color="#ffffff" ground-color="#b0d0ff"></hemisphere-light>

      <!-- Example hotspots -->
      <button slot="hotspot-food" class="hotspot" data-position="1.2 0.2 0.5" data-normal="0 1 0" onclick="window.open('https://example.com/food','_blank')">
        <img src="https://via.placeholder.com/100x100.png?text=🍔" alt="Food">
        <div class="label">Food Court</div>
      </button>

      <button slot="hotspot-shop" class="hotspot" data-position="-1.0 0.2 -0.8" data-normal="0 1 0" onclick="window.open('https://example.com/shop','_blank')">
        <img src="https://via.placeholder.com/100x100.png?text=🛍️" alt="Shop">
        <div class="label">Shop A</div>
      </button>

    </model-viewer>

    <!-- Top Controls -->
    <div class="ui-panel">
      <button id="btn-orient" class="active">Orient</button>
      <button id="btn-explore">Explore</button>
      <div class="floors">
        <button data-floor="ground" class="active">G</button>
        <button data-floor="first">1</button>
        <button data-floor="second">2</button>
        <button data-floor="campus">C</button>
      </div>
    </div>

    <!-- Tilt (phi) slider -->
    <div id="tilt-slider">
      <input type="range" id="phiRange" min="20" max="90" value="60" />
    </div>

    <!-- Bottom controls -->
    <div class="controls-bottom">
      <button id="btn-recenter">Recenter</button>
      <button id="btn-info">Legend</button>
    </div>

    <div class="legend" id="legend">Tap icons for more info</div>

  </div>

<script>
/* -----------------------------
   Configuration
----------------------------- */
const MODEL_SOURCES = {
  ground: 'G_floor_Final.glb',
  first: '1st_floor_Final.glb',
  second: 'second_floor.glb',
  campus: 'campus_map.glb'
};

const viewer = document.getElementById('viewer');
const btnOrient = document.getElementById('btn-orient');
const btnExplore = document.getElementById('btn-explore');
const floorButtons = document.querySelectorAll('.floors button');
const tiltSlider = document.getElementById('tilt-slider');
const phiRange = document.getElementById('phiRange');

let currentMode = 'orient';
let trackingActive = false;
let userInteracting = false;
let northOffset = 0;
let phiAngle = 60;

/* -----------------------------
   Floor switching
----------------------------- */
function setFloor(floor){
  if(!MODEL_SOURCES[floor]) return;
  floorButtons.forEach(b=>b.classList.toggle('active', b.dataset.floor===floor));
  viewer.src = MODEL_SOURCES[floor];
}
floorButtons.forEach(b=>b.addEventListener('click',()=>setFloor(b.dataset.floor)));

/* -----------------------------
   Device orientation for Orient mode
----------------------------- */
function enableOrientation(){
  if(typeof DeviceOrientationEvent !== 'undefined' && DeviceOrientationEvent.requestPermission){
    DeviceOrientationEvent.requestPermission().then(r=>{
      if(r==='granted') window.addEventListener('deviceorientation', handleOrientation, true);
    });
  }else{
    window.addEventListener('deviceorientation', handleOrientation, true);
  }
  trackingActive=true;
}
function disableOrientation(){
  window.removeEventListener('deviceorientation', handleOrientation, true);
  trackingActive=false;
}
function handleOrientation(e){
  if(!trackingActive || userInteracting) return;
  const heading = e.webkitCompassHeading || (360 - e.alpha);
  if(typeof heading === 'number'){
    const corrected = (heading + northOffset) % 360;
    viewer.cameraOrbit = `${corrected}deg ${phiAngle}deg auto`;
  }
}

/* -----------------------------
   Mode toggle
----------------------------- */
function setMode(mode){
  currentMode=mode;
  if(mode==='orient'){
    enableOrientation();
    tiltSlider.style.display='block';
    btnOrient.classList.add('active');
    btnExplore.classList.remove('active');
  }else{
    disableOrientation();
    tiltSlider.style.display='none';
    btnExplore.classList.add('active');
    btnOrient.classList.remove('active');
  }
}
btnOrient.addEventListener('click',()=>setMode('orient'));
btnExplore.addEventListener('click',()=>setMode('explore'));

/* -----------------------------
   Interaction handling
----------------------------- */
viewer.addEventListener('pointerdown',()=>{userInteracting=true;});
viewer.addEventListener('pointerup',()=>{userInteracting=false;});

/* -----------------------------
   Recenter & Legend
----------------------------- */
document.getElementById('btn-recenter').addEventListener('click',()=>{
  viewer.cameraOrbit=`0deg ${phiAngle}deg auto`;
});
document.getElementById('btn-info').addEventListener('click',()=>{
  const l=document.getElementById('legend');
  l.style.display=l.style.display==='none'?'block':'none';
});

/* -----------------------------
   Tilt (phi) slider
----------------------------- */
phiRange.addEventListener('input',()=>{
  phiAngle = parseInt(phiRange.value);
  if(currentMode==='orient'){
    const orbit = viewer.cameraOrbit.split(' ');
    viewer.cameraOrbit = `${orbit[0]} ${phiAngle}deg ${orbit[2]}`;
  }
});

/* -----------------------------
   Init
----------------------------- */
viewer.addEventListener('load',()=>{
  viewer.minCameraOrbit='auto 0deg auto';
  viewer.maxCameraOrbit='auto 90deg auto';
  viewer.cameraOrbit='0deg 60deg auto';
});
setMode('orient');
</script>
</body>
</html>
